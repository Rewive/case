<html>
<header>
    <title>Case</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
</header>

<body>
    <div class="info-box">
        <div class="ball">
            <div class="money">
                <div class="blocka">
                    <p class="case-opn noselect" id="cl_case">Доступно кейсов: 0</p>
                </div>
                <div class="blockb">
                    <img src="money.png" class="money-img noselect">
                    <p class="ballans noselect" id="money">100$</p>
                </div>
                <div class="blockc">
                    <p class="case-ob noselect" id="case_ob">Открыто: 0</p>
                </div>
            </div>
        </div>
    </div>
    <div id="error" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close noselect" onclick="close()">&times;</span>
                <h2 class="noselect" id="s2"></h2>
            </div>
            <div class="modal-footer noselect">
                <h3 id="s3"></h3>
            </div>
        </div>
    </div>
    <div id="shop" class="modals">
        <div class="modals-content">
            <div class="modals-header">
                <span class="close noselect" onclick="close()">&times;</span>
                <h2 class="noselect" id="s2">Shop</h2>
            </div>
            <div class="modals-footer noselect">
                <h4 id="sh3b">Это магазин где вы можете купить кейсы<br>1 кейс стоит 100$<br>Вам доступно: 0 кейсов</h4>
                <h4 id="varn"></h4>
                <input class="shopin" placeholder="Введи количество" id="payn" oninput="prec()"><a class="shopbtn"
                    onclick="pay()">Купить</a>
            </div>
        </div>
    </div>
    <div class="menu noselect" id="menu">
    </div>
    <div class="box" id="case-box">
        <div class="case">
            <a class="case-button noselect" id="case-1">Открой свой первый кейс!</a>
            <a class="case-button-open noselect" onclick="case_open()" id="cs_opn">Открыть</a>
        </div>
    </div>
    <p class="eficensy noselect" id="info">Это кейс класса case-1 и из него тебе может выпасть: <br> 1. Мусор с
        шансом
        90% (+75$)<br> 2. Обычный предмет с шансом 4.5% (+200$) <br> 3. Необычный предмет с шансом 2.5% (+450$) <br>
        4.
        Редкий предмет с
        шансом 1.5% (+750$) <br> 5. Супер редкий предмет с шансом 1% (+1.500$) <br> 6. Эпический предмет с шансом
        0.48%
        (+5.000$) <br> 7.
        Легендарный предмет с шансом 0.02% (+100.000$)</p>
    <p class="debug noselect" id="debug">Debug:<br>Common ---- none<br>Uncommon ---- none<br>Rare ---- none<br>Super
        rare ---- none<br>Epic ---- none<br>Legendar ---- none</p>

</body>

<script>
    let nw_click = 0; cl_case = 1; clca = 0; clb = 0; save = 0; precheck = 0; bal = 500; vp = 0; fo = 0; g = ""; valu = 0; all_case = 0; dost = 0;
    let co = 0; un = 0; ra = 0; sr = 0; ep = 0; le = 0; cop = 0; unp = 0; rap = 0; srp = 0; epp = 0; lep = 0; sum = 0; no = 0; nop = 0;

    document.getElementById("info").style.display = "none";
    document.getElementById("case-box").style.display = "none";

    check();
    balans();


    //var cs = $("#menu").val();
    //$("#menu").append('<div class="native-case-buy" onclick="buy()">' + '<img src="plus.png" class="buy-img">' + '</div>');
    //$("#menu").remove(".native-case-buy");
    //var cs = $("#menu").val();
    //$("#menu").append('<div class="native-case">' + '<a class="open-native" onclick="csm()">Открыть</a>' + '</div>');


    var span = document.getElementsByClassName("close")[0];
    span.onclick = function () {
        document.getElementById("error").style.display = "none";
    }

    var spat = document.getElementsByClassName("close")[1];
    spat.onclick = function () {
        document.getElementById("shop").style.display = "none";
    }

    function check() {
        get();
        if (cl_case > 0) {
            document.getElementById("cs_opn").innerText = "Открыть"
        }
        if (cl_case >= 4) {
            let i = 0;
            $("#menu").empty();
            while (i < 4) {
                var cs = $("#menu").val();
                $("#menu").append('<div class="native-case" id="chon">' + '<a class="open-native noselect" onclick="csm()">Открыть</a>' + '</div>');
                i++
            }
        }
        else if (cl_case < 4) {
            save = 4 - cl_case
            let s = 0; p = 0;
            if (save == 4 && clb == 1) { }
            else {
                $("#menu").empty();
                if (save > 0 && save <= 4) {
                    if (save == 4) {
                        clb++
                    }
                    else {
                        clb = 0
                    }
                    while (p < save) {
                        var cs = $("#menu").val();
                        $("#menu").append('<div class="native-case-buy" onclick="buy()" id="chtw">' + '<img src="plus.png" class="buy-img noselect">' + '</div>');
                        p++
                    }
                    while (s < cl_case) {
                        var cs = $("#menu").val();
                        $("#menu").append('<div class="native-case" id="chon">' + '<a class="open-native noselect" onclick="csm()">Открыть</a>' + '</div>');
                        s++
                    }
                }
            }
        }
    }

    function rand(min, max) {
        ming = Math.ceil(min);
        maxg = Math.floor(max);
        let rand = Math.floor(Math.random() * (maxg - ming)) + ming;
        return rand;
    }

    function csm() {
        if (nw_click == 0) {
            check();
            document.getElementById("menu").style.display = "none";
            document.getElementById("case-box").style.display = "flex";
            document.getElementById("info").style.display = "flex";
            nw_click = 1
        }
        else {
            document.getElementById("menu").style.display = "flex";
            document.getElementById("case-box").style.display = "none";
            document.getElementById("info").style.display = "none";
            check();
            nw_click = 0
        }
    }

    function case_open() {
        get();
        check();
        if (cl_case > 0) {
            ef = rand(1, 10000)
            all_case++
            if (ef >= 1 && ef <= 5000) { // антидроп#1 50% +75$
                status = "none"
                vp += 75
            }
            else if (ef >= 5001 && ef <= 5250) { // 1 кейс-лут "необычный" 2.5% +200$
                status = "uncommon"
                vp += 450
            }
            else if (ef >= 5250 && ef <= 5400) { // 2 кейс-лут "редкий" 1.5% +750$
                status = "rare"
                vp += 750
            }
            else if (ef >= 5401 && ef <= 8400) { // антидроп#2 30% +75$
                status = "none"
                vp += 75
            }
            else if (ef >= 8401 && ef <= 8500) { // 3 кейс-лут "супер редкий" 1% +1.500$
                status = "superrare"
                vp += 1500
            }
            else if (ef >= 8501 && ef <= 8950) { // 4 кейс-лут "обычный" 4.5% +450$
                status = "common"
                vp += 200
            }
            else if (ef >= 8951 && ef <= 9950) { // антидроп#3 10% +75$
                status = "none"
                vp += 75
            }
            else if (ef >= 9951 && ef <= 9998) { // 5 кейс-лут "эпический" 0.48% +5.000$
                status = "epic"
                vp += 5000
            }
            else if (ef >= 9999 && ef <= 10000) { // 6 кейс-лут "легендарный" 0.02% +100.000$
                status = "legendar"
                vp += 100000
            }
            ef = ""
            cl_case -= 1;
            set();
            result(status);
            if (cl_case == 0) {
                document.getElementById("cs_opn").innerText = "Выйти"
            }
        }
        else {
            csm();
        }
    }

    function procents() {
        sum = un + co + ra + sr + ep + le + no;
        unp = (un * 100 / sum).toFixed(2)// 1
        cop = (co * 100 / sum).toFixed(2)// 2
        rap = (ra * 100 / sum).toFixed(2)// 3
        srp = (sr * 100 / sum).toFixed(2)// 4
        epp = (ep * 100 / sum).toFixed(2)// 5
        lep = (le * 100 / sum).toFixed(2)// 6
        nop = (no * 100 / sum).toFixed(2)// 7
        document.getElementById("debug").innerText = "Debug:\nCommon ---- " + co + " ---- " + cop + "%\nUncommon ---- " + un + " ---- " + unp + "%\nRare ---- " + ra + " ---- " + rap + "%\nSuper rare ---- " + sr + " ---- " + srp + "%\nEpic ---- " + ep + " ---- " + epp + "%\nLegendar ---- " + le + " ---- " + lep + "%\n ------------------------\nAntidrop ---- " + no + " ---- " + nop + "%"
    }

    function plus() {
        get();
        bal += vp;
        vp = 0;
        set();
    }

    function result(main_status) {
        status = main_status
        document.getElementById("case-1").style.background = "none";
        if (status == 'uncommon') {
            document.getElementById("case-1").style.backgroundColor = "orange";
            ru_status = "необычный"
            res = "Тебе выпал " + ru_status + " предмет!"
            un += 1
            procents();

            plus();
            balans("pl");
            check();
        }
        else if (status == 'common') {
            document.getElementById("case-1").style.backgroundColor = "red";
            ru_status = "обычный"
            res = "Тебе выпал " + ru_status + " предмет!"
            co += 1
            procents();

            plus();
            balans("pl");
            check();
        }
        else if (status == 'rare') {
            document.getElementById("case-1").style.backgroundColor = "blue";
            ru_status = "редкий"
            res = "Тебе выпал " + ru_status + " предмет!"
            ra += 1
            procents();

            plus();
            balans("pl");
            check();
        }
        else if (status == 'superrare') {
            document.getElementById("case-1").style.backgroundColor = "green";
            ru_status = "супер редкий"
            res = "Тебе выпал " + ru_status + " предмет!"
            sr += 1
            procents();

            plus();
            balans("pl");
            check();
        }
        else if (status == 'epic') {
            document.getElementById("case-1").style.backgroundColor = "violet";
            ru_status = "эпический"
            res = "Тебе выпал " + ru_status + " предмет!"
            ep += 1
            procents();

            plus();
            balans("pl");
            check();
        }
        else if (status == 'legendar') {
            document.getElementById("case-1").style.background = "linear-gradient(135deg, #ff05d9, #2e5bff, #33ffb8, #3cff6d, #2e5bff, #ff05d9)";
            document.getElementById("case-1").style.backgroundSize = "500% 500%";
            document.getElementById("case-1").style.animation = "legendar 20s ease infinite";
            ru_status = "легендарный"
            res = "Тебе выпал " + ru_status + " предмет!"
            le += 1
            procents();

            plus();
            balans("pl");
            check();
        }
        else if (status == 'none') {
            document.getElementById("case-1").style.backgroundColor = "brown";
            ru_status = "мусор"
            res = "К сожелению в кейсе был только " + ru_status + " :("
            no += 1
            procents();

            plus();
            balans("pl");
            check();
        }
        document.getElementById("case-1").innerText = res;
    }

    function balans(at) {
        get();
        document.getElementById('money').innerText = bal + "$";
        if (bal < 0) {
            document.getElementById('money').style.animation = "low-bal 4s ease infinite";
        }
        else if (bal >= 0) {
            if (at == "pl") {
                document.getElementById('money').style.animation = "n-bal 2s";
            }
            else if (at == "m") {
                document.getElementById('money').style.animation = "m-bal 2s";
            }
            else {
                document.getElementById('money').style.animation = "none";
            }
        }
    }

    function buy() {
        get();
        document.getElementById("shop").style.display = "block";
        dost = Math.floor(bal / 100)
        document.getElementById("sh3b").innerText = "Это магазин где вы можете купить кейсы\n1 кейс стоит 100$\nВам доступно: " + dost + " кейсов";
    }

    function pay() {
        valu = document.getElementById("payn").value
        if (valu <= dost) {
            let col = valu * 100
            get();
            let valp = bal - col
            if (valp >= 0) {
                bal -= col;
                cl_case = cl_case + Number(valu);
                set();
                check();
                document.getElementById("shop").style.display = "none";
                balans("m");
                document.getElementById("case-1").innerText = "Открой кейс :)"
                document.getElementById("case-1").style.backgroundColor = "rgb(181, 181, 181)";
            }
            else {
                document.getElementById("shop").style.display = "none";
                document.getElementById("error").style.display = "block"
                document.getElementById("s2").innerText = "Ошибка!"
                document.getElementById("s3").innerText = "На вашем счету недостаточно средств :("
                balans();
                check();
                span.onclick = function () {
                    document.getElementById("error").style.display = "none";
                    document.getElementById("shop").style.display = "block";
                }
            }
        }
        else {
        }
    }

    function prec() {
        valu = document.getElementById("payn").value
        if (valu <= dost) { 
            document.getElementById("payn").style.color = "#575757";
            document.getElementById("varn").style.color = "#575757";
            document.getElementById("varn").innerText = "";
        }
        else {
            document.getElementById("varn").innerText = "Вы не можете покупать кейсов больше чем " + dost + " кейсов";
            document.getElementById("payn").style.color = "red";
            document.getElementById("varn").style.color = "red";
        }
    }

    function get() {
        fo = Number(localStorage.getItem('fo'));
        document.getElementById("cl_case").innerText = "Доступно кейсов: " + cl_case;
        document.getElementById("case_ob").innerText = "Открыто: " + all_case;
        if (fo == 1) {
            cl_case = Number(localStorage.getItem('case'));
            bal = Number(localStorage.getItem('bal'));
            all_case = Number(localStorage.getItem('all'));
        }
        else if (fo == 0) {
            fo = 1;
            set();
        }
    }

    function set() {
        localStorage.setItem('case', cl_case);
        localStorage.setItem('bal', bal);
        localStorage.setItem('fo', fo);
        localStorage.setItem('all', all_case);
    }

</script>

</html>